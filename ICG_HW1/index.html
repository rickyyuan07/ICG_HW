<html>

<head>
<title>ICG WebGL &mdash; HW1</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script type="text/javascript" src="./js/glMatrix-0.9.5.min.js"></script>
<script type="text/javascript" src="./js/webgl-utils.js"></script>

<script type="text/javascript">
    // common variables
    var gl;
    var shaderProgram;

    var mvMatrix = mat4.create();
    var pMatrix  = mat4.create();
    var nmMatrix  = mat4.create();

    var midVertexPositionBuffer;
    var midVertexNormalBuffer;
    var midVertexFrontColorBuffer;

    var leftVertexPositionBuffer;
    var leftVertexNormalBuffer;
    var leftVertexFrontColorBuffer;

    var rightVertexPositionBuffer;
    var rightVertexNormalBuffer;
    var rightVertexFrontColorBuffer;

    var brightnessRatio = 1.0;
    var leftAngle = 180;
    var midAngle = 180;
    var rightAngle = 180;
    var lastTime    = 0;
    var leftSpeed = 0;
    var midSpeed = 0;
    var rightSpeed = 0;
    
    function initGL(canvas) {
        try {
            gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
            gl.viewportWidth  = canvas.width;
            gl.viewportHeight = canvas.height;
        }
        catch (e) {
        }

        if (!gl) {
            alert("Could not initialise WebGL, sorry :-(");
        }
        if(!gl.getExtension('OES_standard_derivatives')) {
            throw 'extension not support';
        }
    }

    async function getShader(gl, id) {
        var shaderScript = await(await fetch(`./${id}.glsl`)).text();
        if (!shaderScript)
            return null;

        var shader;
        if (id == "fragmentShader")
            shader = gl.createShader(gl.FRAGMENT_SHADER);
        else if (id == "vertexShader")
            shader = gl.createShader(gl.VERTEX_SHADER);
        else
            return null;

        gl.shaderSource(shader, shaderScript);
        gl.compileShader(shader);

        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
            alert(gl.getShaderInfoLog(shader));
            return null;
        }

        return shader;
    }

    async function initShaders() {
        var fragmentShader = await getShader(gl, "fragmentShader");
        var vertexShader   = await getShader(gl, "vertexShader");

        shaderProgram = gl.createProgram();
        gl.attachShader(shaderProgram, vertexShader);
        gl.attachShader(shaderProgram, fragmentShader);
        gl.linkProgram(shaderProgram);

        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
            alert("Could not initialise shaders");
        }

        gl.useProgram(shaderProgram);

        shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");
        gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);
        shaderProgram.vertexFrontColorAttribute = gl.getAttribLocation(shaderProgram, "aFrontColor");
        gl.enableVertexAttribArray(shaderProgram.vertexFrontColorAttribute);
        shaderProgram.vertexNormalAttribute = gl.getAttribLocation(shaderProgram, "aVertexNormal");
        gl.enableVertexAttribArray(shaderProgram.vertexNormalAttribute);

        shaderProgram.pMatrixUniform  = gl.getUniformLocation(shaderProgram, "uPMatrix");
        shaderProgram.mvMatrixUniform = gl.getUniformLocation(shaderProgram, "uMVMatrix");
        shaderProgram.nmMatrixUniform = gl.getUniformLocation(shaderProgram, "uNMMatrix");
        shaderProgram.shadeMode = gl.getUniformLocation(shaderProgram, "mode");
        shaderProgram.k = gl.getUniformLocation(shaderProgram, "k");
        shaderProgram.light_pos1 = gl.getUniformLocation(shaderProgram, "light_pos1");
        shaderProgram.light_col1 = gl.getUniformLocation(shaderProgram, "light_col1");
        shaderProgram.light_pos2 = gl.getUniformLocation(shaderProgram, "light_pos2");
        shaderProgram.light_col2 = gl.getUniformLocation(shaderProgram, "light_col2");
        shaderProgram.light_pos3 = gl.getUniformLocation(shaderProgram, "light_pos3");
        shaderProgram.light_col3 = gl.getUniformLocation(shaderProgram, "light_col3");
    }

    function setMatrixUniforms() {
        gl.uniformMatrix4fv(shaderProgram.pMatrixUniform, false, pMatrix);
        gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform, false, mvMatrix);
        gl.uniformMatrix4fv(shaderProgram.nmMatrixUniform, false, nmMatrix);
    }

    function degToRad(degrees) {
        return degrees * Math.PI / 180;
    }

    function handleLoadedMid(objectData) {
        midVertexPositionBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, midVertexPositionBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(objectData.vertexPositions), gl.STATIC_DRAW);
        midVertexPositionBuffer.itemSize = 3;
        midVertexPositionBuffer.numItems = objectData.vertexPositions.length / 3;

        midVertexNormalBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, midVertexNormalBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(objectData.vertexNormals), gl.STATIC_DRAW);
        midVertexNormalBuffer.itemSize = 3;
        midVertexNormalBuffer.numItems = objectData.vertexNormals.length / 3;

        midVertexFrontColorBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, midVertexFrontColorBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(objectData.vertexFrontcolors), gl.STATIC_DRAW);
        midVertexFrontColorBuffer.itemSize = 3;
        midVertexFrontColorBuffer.numItems = objectData.vertexFrontcolors.length / 3;
    }

    function handleLoadedLeft(objectData) {
        leftVertexPositionBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, leftVertexPositionBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(objectData.vertexPositions), gl.STATIC_DRAW);
        leftVertexPositionBuffer.itemSize = 3;
        leftVertexPositionBuffer.numItems = objectData.vertexPositions.length / 3;

        leftVertexNormalBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, leftVertexNormalBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(objectData.vertexNormals), gl.STATIC_DRAW);
        leftVertexNormalBuffer.itemSize = 3;
        leftVertexNormalBuffer.numItems = objectData.vertexNormals.length / 3;

        leftVertexFrontColorBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, leftVertexFrontColorBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(objectData.vertexFrontcolors), gl.STATIC_DRAW);
        leftVertexFrontColorBuffer.itemSize = 3;
        leftVertexFrontColorBuffer.numItems = objectData.vertexFrontcolors.length / 3;
    }

    function handleLoadedRight(objectData) {
        rightVertexPositionBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, rightVertexPositionBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(objectData.vertexPositions), gl.STATIC_DRAW);
        rightVertexPositionBuffer.itemSize = 3;
        rightVertexPositionBuffer.numItems = objectData.vertexPositions.length / 3;

        rightVertexNormalBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, rightVertexNormalBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(objectData.vertexNormals), gl.STATIC_DRAW);
        rightVertexNormalBuffer.itemSize = 3;
        rightVertexNormalBuffer.numItems = objectData.vertexNormals.length / 3;

        rightVertexFrontColorBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, rightVertexFrontColorBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(objectData.vertexFrontcolors), gl.STATIC_DRAW);
        rightVertexFrontColorBuffer.itemSize = 3;
        rightVertexFrontColorBuffer.numItems = objectData.vertexFrontcolors.length / 3;
    }

    function loadObjects() {
        var request = new XMLHttpRequest();
        request.open("GET", `./model/${document.getElementById("itemMid").value}.json`);
        request.onreadystatechange = function () {
            if (request.readyState == 4) {
                handleLoadedMid(JSON.parse(request.responseText));
            }
        }
        request.send();

        var request1 = new XMLHttpRequest();
        request1.open("GET", `./model/${document.getElementById("itemRight").value}.json`);
        request1.onreadystatechange = function () {
            if (request1.readyState == 4) {
                handleLoadedRight(JSON.parse(request1.responseText));
            }
        }
        request1.send();

        var request2 = new XMLHttpRequest();
        request2.open("GET", `./model/${document.getElementById("itemLeft").value}.json`);
        request2.onreadystatechange = function () {
            if (request2.readyState == 4) {
                handleLoadedLeft(JSON.parse(request2.responseText));
            }
        }
        request2.send();
    }

    /*
        TODO HERE:
        add two or more objects showing on the canvas
        (it needs at least three objects showing at the same time)
    */
    function drawScene() {
        gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

        if (midVertexPositionBuffer   == null || 
            midVertexNormalBuffer     == null || 
            midVertexFrontColorBuffer == null ||
            leftVertexPositionBuffer   == null || 
            leftVertexNormalBuffer     == null || 
            leftVertexFrontColorBuffer == null ||
            rightVertexPositionBuffer   == null || 
            rightVertexNormalBuffer     == null || 
            rightVertexFrontColorBuffer == null) {
            return;
        }
        
        // Setup Projection Matrix
        mat4.perspective(45, gl.viewportWidth / gl.viewportHeight, 0.1, 100.0, pMatrix);

        // Attributes
        leftSpeed = document.getElementById("leftSpinSpeed").value;
        midSpeed = document.getElementById("midSpinSpeed").value;
        rightSpeed = document.getElementById("rightSpinSpeed").value;
        var midX = document.getElementById("midX");
        var midY = document.getElementById("midY");
        var midZ = document.getElementById("midZ");
        var lambdaY_onX = document.getElementById("mid_lambday_x").value;
        var lambdaZ_onX = 0;
        var lambdaX_onY = document.getElementById("mid_lambdax_y").value;
        var lambdaZ_onY = 0;
        var lambdaX_onZ = document.getElementById("mid_lambdax_z").value;
        var lambdaY_onZ = document.getElementById("mid_lambday_z").value;
        var checked = 0;
        var midShading = document.getElementById('shadingMid').value;
        var MaxLeft = Number(document.getElementById("LeftMax").value);
        var MinLeft = Number(document.getElementById("LeftMin").value);
        var MaxMid = Number(document.getElementById("MidMax").value);
        var MinMid = Number(document.getElementById("MidMin").value);
        var MaxRight = Number(document.getElementById("RightMax").value);
        var MinRight = Number(document.getElementById("RightMin").value);

        MaxLeft = Math.max(Math.min(MaxLeft, 1.0), 0.0);
        MaxMid = Math.max(Math.min(MaxMid, 1.0), 0.0);
        MaxRight = Math.max(Math.min(MaxRight, 1.0), 0.0);
        MinLeft = Math.max(Math.min(MinLeft, MaxLeft), 0.0);
        MinMid = Math.max(Math.min(MinMid, MaxMid), 0.0);
        MinRight = Math.max(Math.min(MinRight, MaxRight), 0.0);

        var leftBright = MinLeft + brightnessRatio * (MaxLeft - MinLeft);
        var midBright = MinMid + brightnessRatio * (MaxMid - MinMid);
        var rightBright = MinRight + brightnessRatio * (MaxRight - MinRight);

        gl.uniform3f(shaderProgram.light_pos1,
                    document.getElementById("First_x").value,
                    document.getElementById("First_y").value,
                    document.getElementById("First_z").value);
        gl.uniform3f(shaderProgram.light_col1,
                    document.getElementById("First_r").value * leftBright,
                    document.getElementById("First_g").value * leftBright,
                    document.getElementById("First_b").value * leftBright);
        gl.uniform3f(shaderProgram.light_pos2,
                    document.getElementById("Second_x").value,
                    document.getElementById("Second_y").value,
                    document.getElementById("Second_z").value);
        gl.uniform3f(shaderProgram.light_col2,
                    document.getElementById("Second_r").value * midBright,
                    document.getElementById("Second_g").value * midBright,
                    document.getElementById("Second_b").value * midBright);
        gl.uniform3f(shaderProgram.light_pos3,
                    document.getElementById("Third_x").value,
                    document.getElementById("Third_y").value,
                    document.getElementById("Third_z").value);
        gl.uniform3f(shaderProgram.light_col3,
                    document.getElementById("Third_r").value * rightBright,
                    document.getElementById("Third_g").value * rightBright,
                    document.getElementById("Third_b").value * rightBright);

        all_translate = [midX.value, midY.value, midZ.value]
        var size = [1, 1, 1];
        size[0] = parseFloat(document.getElementById("sizeMid").value);
        size[1] = parseFloat(document.getElementById("sizeMid").value);
        size[2] = parseFloat(document.getElementById("sizeMid").value);
        
        var shearMat = mat4.create();
        mat4.set(
            [1.0, lambdaY_onX, lambdaZ_onX, 0.0,
            lambdaX_onY, 1.0, lambdaZ_onY, 0.0,
            lambdaX_onZ, lambdaY_onZ, 1.0, 0.0,
            0.0, 0.0, 0.0, 1.0],
            shearMat
        )
        mat4.transpose(shearMat, shearMat);
        
        // Setup Model-View Matrix
        mat4.identity(mvMatrix);
        mat4.multiply(shearMat, mvMatrix, mvMatrix);
        mat4.translate(mvMatrix, all_translate);
        mat4.rotate(mvMatrix, degToRad(midAngle), [0, 1, 0]);
        mat4.scale(mvMatrix, size);

        // Setup Normal Matrix
        mat4.identity(nmMatrix);
        mat4.translate(nmMatrix, all_translate);
        mat4.multiply(shearMat,nmMatrix, nmMatrix);
        mat4.rotate(nmMatrix, degToRad(midAngle), [0, 1, 0]);
        mat4.scale(nmMatrix, size);
        mat4.inverse(nmMatrix, nmMatrix);
        mat4.transpose(nmMatrix, nmMatrix);

        gl.uniform1i(shaderProgram.shadeMode, midShading); // 1: gouraud, 2: phong, 3: flat, 4: cel
        gl.uniform3f(shaderProgram.k, 0.14, 0.2, 0.66);
        // gl.uniform3f(shaderProgram.k, 0.1, 0.6, 0.3);

        setMatrixUniforms();

        // Setup teapot position data
        gl.bindBuffer(gl.ARRAY_BUFFER, midVertexPositionBuffer);
        gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, 
                                midVertexPositionBuffer.itemSize, 
                               gl.FLOAT, 
                               false, 
                               0, 
                               0);

        // Setup teapot front color data
        gl.bindBuffer(gl.ARRAY_BUFFER, midVertexFrontColorBuffer);
        gl.vertexAttribPointer(shaderProgram.vertexFrontColorAttribute, 
                               midVertexFrontColorBuffer.itemSize, 
                               gl.FLOAT, 
                               false, 
                               0, 
                               0);

        // Setup teapot vertex normal data
        gl.bindBuffer(gl.ARRAY_BUFFER, midVertexNormalBuffer);
        gl.vertexAttribPointer(shaderProgram.vertexNormalAttribute, 
                            midVertexNormalBuffer.itemSize, 
                            gl.FLOAT,
                            false,
                            0,
                            0);

        gl.drawArrays(gl.TRIANGLES, 0, midVertexPositionBuffer.numItems);
        // Attributes
        var lambdaY_onX = document.getElementById("right_lambday_x").value;
        var lambdaZ_onX = 0;
        var lambdaX_onY = document.getElementById("right_lambdax_y").value;
        var lambdaZ_onY = 0;
        var lambdaX_onZ = document.getElementById("right_lambdax_z").value;
        var lambdaY_onZ = document.getElementById("right_lambday_z").value;
        mat4.set(
            [1.0, lambdaY_onX, lambdaZ_onX, 0.0,
            lambdaX_onY, 1.0, lambdaZ_onY, 0.0,
            lambdaX_onZ, lambdaY_onZ, 1.0, 0.0,
            0.0, 0.0, 0.0, 1.0],
            shearMat
        )
        mat4.transpose(shearMat, shearMat);

        var rightX = document.getElementById("rightX");
        var rightY = document.getElementById("rightY");
        var rightZ = document.getElementById("rightZ");
        var rightShading = document.getElementById('shadingRight').value;

        all_translate = [rightX.value, rightY.value, rightZ.value]
        size[0] = parseFloat(document.getElementById("sizeRight").value)
        size[1] = parseFloat(document.getElementById("sizeRight").value)
        size[2] = parseFloat(document.getElementById("sizeRight").value)

        // Setup Model-View Matrix
        mat4.identity(mvMatrix);
        mat4.multiply(shearMat, mvMatrix, mvMatrix);
        mat4.translate(mvMatrix, all_translate);
        mat4.rotate(mvMatrix, degToRad(rightAngle), [0, 1, 0]);
        mat4.rotate(mvMatrix, -0.3, [0,1,0]);
        mat4.rotate(mvMatrix, -1.5, [1,0,0]);
        mat4.scale(mvMatrix, size);

        // Setup Normal Matrix
        mat4.identity(nmMatrix);
        mat4.multiply(shearMat, nmMatrix, nmMatrix);
        mat4.translate(nmMatrix, all_translate);
        mat4.rotate(nmMatrix, degToRad(rightAngle), [0, 1, 0]);
        mat4.rotate(nmMatrix, -0.3, [0,1,0]);
        mat4.rotate(nmMatrix, -1.5, [1,0,0]);
        mat4.scale(nmMatrix, size);
        mat4.inverse(nmMatrix, nmMatrix);
        mat4.transpose(nmMatrix, nmMatrix);

        gl.uniform1i(shaderProgram.shadeMode, rightShading); // 1: gouraud, 2: phong, 3: flat, 4: cel
        gl.uniform3f(shaderProgram.k, 0.14, 0.2, 0.66);

        // Setup teapot position data
        gl.bindBuffer(gl.ARRAY_BUFFER, rightVertexPositionBuffer);
        gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, 
                            rightVertexPositionBuffer.itemSize, 
                            gl.FLOAT, 
                            false, 
                            0, 
                            0);

        // Setup teapot front color data
        gl.bindBuffer(gl.ARRAY_BUFFER, rightVertexFrontColorBuffer);
        gl.vertexAttribPointer(shaderProgram.vertexFrontColorAttribute, 
                            rightVertexFrontColorBuffer.itemSize, 
                            gl.FLOAT, 
                            false, 
                            0, 
                            0);

        // Setup teapot vertex normal data
        gl.bindBuffer(gl.ARRAY_BUFFER, rightVertexNormalBuffer);
        gl.vertexAttribPointer(shaderProgram.vertexNormalAttribute, 
                            rightVertexNormalBuffer.itemSize, 
                            gl.FLOAT,
                            false,
                            0,
                            0);

        setMatrixUniforms();
        gl.drawArrays(gl.TRIANGLES, 0, rightVertexPositionBuffer.numItems);

        // Attributes
        var lambdaY_onX = document.getElementById("left_lambday_x").value;
        var lambdaZ_onX = 0;
        var lambdaX_onY = document.getElementById("left_lambdax_y").value;
        var lambdaZ_onY = 0;
        var lambdaX_onZ = document.getElementById("left_lambdax_z").value;
        var lambdaY_onZ = document.getElementById("left_lambday_z").value;
        mat4.set(
            [1.0, lambdaY_onX, lambdaZ_onX, 0.0,
            lambdaX_onY, 1.0, lambdaZ_onY, 0.0,
            lambdaX_onZ, lambdaY_onZ, 1.0, 0.0,
            0.0, 0.0, 0.0, 1.0],
            shearMat
        )
        mat4.transpose(shearMat, shearMat);

        var leftX = document.getElementById("leftX");
        var leftY = document.getElementById("leftY");
        var leftZ = document.getElementById("leftZ");
        var leftShading = document.getElementById('shadingLeft').value;
        
        all_translate = [leftX.value, leftY.value, leftZ.value]
        size[0] = parseFloat(document.getElementById("sizeLeft").value);
        size[1] = parseFloat(document.getElementById("sizeLeft").value);
        size[2] = parseFloat(document.getElementById("sizeLeft").value);

        // Setup Model-View Matrix
        mat4.identity(mvMatrix);
        mat4.multiply(shearMat, mvMatrix, mvMatrix);
        mat4.translate(mvMatrix, all_translate);
        mat4.rotate(mvMatrix, degToRad(leftAngle), [0, 1, 0]);
        mat4.translate(mvMatrix, [-6, 0, 5]);
        mat4.rotate(mvMatrix, -1.57, [1,0,0]);
        mat4.scale(mvMatrix, size);

        // Setup Normal Matrix
        mat4.identity(nmMatrix);
        mat4.multiply(shearMat, nmMatrix, nmMatrix);
        mat4.translate(nmMatrix, all_translate);
        mat4.rotate(nmMatrix, degToRad(leftAngle), [0, 1, 0]);
        mat4.translate(nmMatrix, [-6, 0, 5]);
        mat4.rotate(nmMatrix, -1.57, [1,0,0]);
        mat4.scale(nmMatrix, size);
        mat4.inverse(nmMatrix, nmMatrix);
        mat4.transpose(nmMatrix, nmMatrix);

        gl.uniform1i(shaderProgram.shadeMode, leftShading); // 1: gouraud, 2: phong, 3: flat, 4: cel
        gl.uniform3f(shaderProgram.k, 0.14, 0.2, 0.66);

        // Setup teapot position data
        gl.bindBuffer(gl.ARRAY_BUFFER, leftVertexPositionBuffer);
        gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, 
                            leftVertexPositionBuffer.itemSize, 
                            gl.FLOAT, 
                            false, 
                            0, 
                            0);

        // Setup teapot front color data
        gl.bindBuffer(gl.ARRAY_BUFFER, leftVertexFrontColorBuffer);
        gl.vertexAttribPointer(shaderProgram.vertexFrontColorAttribute, 
                            leftVertexFrontColorBuffer.itemSize, 
                            gl.FLOAT, 
                            false, 
                            0, 
                            0);

        // Setup teapot vertex normal data
        gl.bindBuffer(gl.ARRAY_BUFFER, leftVertexNormalBuffer);
        gl.vertexAttribPointer(shaderProgram.vertexNormalAttribute, 
                            leftVertexNormalBuffer.itemSize, 
                            gl.FLOAT,
                            false,
                            0,
                            0);

        setMatrixUniforms();
        gl.drawArrays(gl.TRIANGLES, 0, leftVertexPositionBuffer.numItems);
    }

    function animate() {
        var timeNow = new Date().getTime();
        var jitterPeriod = 1.2;
        if (lastTime != 0) {
            brightnessRatio = Math.abs((timeNow%(jitterPeriod * 1000) - (jitterPeriod * 500)) / (jitterPeriod * 500))
            var elapsed = timeNow - lastTime;
            var dir = document.getElementsByName('rightDir');
            for(i = 0; i < dir.length; i++) {
                if(dir[i].type="radio") {
                    if(dir[i].checked)
                        checked = dir[i].value;
                }
            }
            rightAngle += checked * rightSpeed * elapsed / 100;
            dir = document.getElementsByName('midDir');
            for(i = 0; i < dir.length; i++) {
                if(dir[i].type="radio") {
                    if(dir[i].checked)
                        checked = dir[i].value;
                }
            }
            midAngle += checked * midSpeed * elapsed / 100;
            dir = document.getElementsByName('leftDir');
            for(i = 0; i < dir.length; i++) {
                if(dir[i].type="radio") {
                    if(dir[i].checked)
                        checked = dir[i].value;
                }
            }
            leftAngle += checked * leftSpeed * elapsed / 100;
        }
        
        lastTime = timeNow;
    }

    function tick() {
        requestAnimFrame(tick);
        drawScene();
        animate();
    }

    async function webGLStart() {
        var canvas = document.getElementById("ICG-canvas");
        initGL(canvas);
        await initShaders();
        loadObjects();

        gl.clearColor(0.0, 0.2, 0.2, 1.0);
        gl.enable(gl.DEPTH_TEST);

        tick();
    }
</script>
<link rel="stylesheet" href="style.css">
</head>

<body onload="webGLStart();">
<div class="all">
    <canvas id="ICG-canvas" style="border: none;" width="850" height="600"></canvas>
    <table class="table1">
        <tr>
            <td class="name"></td>
            <td class="value">First Item</td>
            <td class="value">Second Item</td>
            <td class="value">Third Item</td>
        </tr>
        <tr>
            <td class="name">Item</td>
            <td class="name">
                <select name="itemLeft" id="itemLeft" onchange="loadObjects()">
                  <option value="Car_road">Car_road</option>
                  <option value="Church_s">Church_s</option>
                  <option value="Csie">Csie</option>
                  <option value="Easter">Easter</option>
                  <option value="Fighter">Fighter</option>
                  <option value="Kangaroo">Kangaroo</option>
                  <option value="Longteap">Longteap</option>
                  <option value="Mercedes">Mercedes</option>
                  <option value="Mig27">Mig27</option>
                  <option value="Patchair">Patchair</option>
                  <option value="Plant">Plant</option>
                  <option value="Teapot">Teapot</option>
                  <option value="Tomcat">Tomcat</option>
                </select>
            </td>
            <td class="name">
                <select name="itemMid" id="itemMid" onchange="loadObjects()">
                    <option value="Car_road">Car_road</option>
                    <option value="Church_s">Church_s</option>
                    <option value="Csie">Csie</option>
                    <option value="Easter">Easter</option>
                    <option value="Fighter">Fighter</option>
                    <option value="Kangaroo">Kangaroo</option>
                    <option value="Longteap">Longteap</option>
                    <option value="Mercedes">Mercedes</option>
                    <option value="Mig27">Mig27</option>
                    <option value="Patchair">Patchair</option>
                    <option value="Plant">Plant</option>
                    <option value="Teapot">Teapot</option>
                    <option value="Tomcat">Tomcat</option>
                </select>
            </td>
            <td class="name">
                <select name="itemRight" id="itemRight" onchange="loadObjects()">
                    <option value="Car_road">Car_road</option>
                    <option value="Church_s">Church_s</option>
                    <option value="Csie">Csie</option>
                    <option value="Easter">Easter</option>
                    <option value="Fighter">Fighter</option>
                    <option value="Kangaroo">Kangaroo</option>
                    <option value="Longteap">Longteap</option>
                    <option value="Mercedes">Mercedes</option>
                    <option value="Mig27">Mig27</option>
                    <option value="Patchair">Patchair</option>
                    <option value="Plant">Plant</option>
                    <option value="Teapot">Teapot</option>
                    <option value="Tomcat">Tomcat</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="name">Shading Model</td>
            <td class="value radios">
                <select name="shadingLeft" id="shadingLeft">
                  <option value="1">Gouraud Shading</option>
                  <option value="2">Phong Shading</option>
                  <option value="3">Flat Shading</option>
                  <option value="4">Cel Shading</option>
                </select>
            </td>
            <td class="value radios">
                <select name="shadingMid" id="shadingMid">
                  <option value="1">Gouraud Shading</option>
                  <option value="2">Phong Shading</option>
                  <option value="3">Flat Shading</option>
                  <option value="4">Cel Shading</option>
                </select>
            </td>
            <td class="value radios">
                <select name="shadingRight" id="shadingRight">
                  <option value="1">Gouraud Shading</option>
                  <option value="2">Phong Shading</option>
                  <option value="3">Flat Shading</option>
                  <option value="4">Cel Shading</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="name">X-Axis Position</td>
            <td class="value">
                <input type="range" min="-80" max="80" value="-30" class="obj_controller" id="leftX">
            </td>
            <td class="value">
                <input type="range" min="-80" max="80" value="0" class="obj_controller" id="midX">
            </td>
            <td class="value">
                <input type="range" min="-80" max="80" value="30" class="obj_controller" id="rightX">
            </td>
        </tr>
        <tr>
            <td class="name">Y-Axis Position</td>
            <td class="value">
                <input type="range" min="-85" max="75" value="-5" class="obj_controller" id="leftY">
            </td>
            <td class="value">
                <input type="range" min="-80" max="80" value="0" class="obj_controller" id="midY">
            </td>
            <td class="value">
                <input type="range" min="-70" max="90" value="10" class="obj_controller" id="rightY">
            </td>
        </tr>
        <tr>
            <td class="name">Z-Axis Position</td>
            <td class="value">
                <input type="range" min="-140" max="0" value="-70" class="obj_controller" id="leftZ">
            </td>
            <td class="value">
                <input type="range" min="-140" max="0" value="-70" class="obj_controller" id="midZ">
            </td>
            <td class="value">
                <input type="range" min="-140" max="0" value="-70" class="obj_controller" id="rightZ">
            </td>
        </tr>
        <tr>
            <td class="name">Size</td>
            <td class="value">
                <input type="range" id="sizeLeft" min="0" max="10" value="1" class="obj_controller" step="0.1">
            </td>
            <td class="value">
                <input type="range" id="sizeMid" min="0" max="10" value="1" class="obj_controller" step="0.1">
            </td>
            <td class="value">
                <input type="range" id="sizeRight" min="0" max="10" value="1" class="obj_controller" step="0.1">
            </td>
        </tr>
        <tr>
            <td class="name">Shear Along X-Axis</td>
            <td class="value">
                <label for="left_lambday_x">Lambda Y:</label>
                <input type="number" id="left_lambday_x" name="quantity" min="-3" max="3" value="0" step="0.2">
            </td>
            <td class="value">
                <label for="mid_lambday_x">Lambda Y:</label>
                <input type="number" id="mid_lambday_x" name="quantity" min="-3" max="3" value="0" step="0.2">
            </td>
            <td class="value">
                <label for="right_lambday_x">Lambda Y:</label>
                <input type="number" id="right_lambday_x" name="quantity" min="-3" max="3" value="0" step="0.2">
            </td>
        </tr>
        <tr>
            <td class="name">Shear Along Y-Axis</td>
            <td class="value">
                <label for="left_lambdax_y">Lambda X:</label>
                <input type="number" id="left_lambdax_y" name="quantity" min="-3" max="3" value="0" step="0.2">
            </td>
            <td class="value">
                <label for="mid_lambdax_y">Lambda X:</label>
                <input type="number" id="mid_lambdax_y" name="quantity" min="-3" max="3" value="0" step="0.2">
            </td>
            <td class="value">
                <label for="right_lambdax_y">Lambda X:</label>
                <input type="number" id="right_lambdax_y" name="quantity" min="-3" max="3" value="0" step="0.2">
            </td>
        </tr>
        <tr>
            <td class="name">Shear Along Z-Axis</td>
            <td class="value">
                <label for="left_lambdax_z">Lambda X:</label>
                <input type="number" id="left_lambdax_z" name="quantity" min="-3" max="3" value="0" step="0.2">
                <label for="left_lambday_z">Lambda Y:</label>
                <input type="number" id="left_lambday_z" name="quantity" min="-3" max="3" value="0" step="0.2">
            </td>
            <td class="value">
                <label for="mid_lambdax_z">Lambda X:</label>
                <input type="number" id="mid_lambdax_z" name="quantity" min="-3" max="3" value="0" step="0.2">
                <label for="mid_lambday_z">Lambda Y:</label>
                <input type="number" id="mid_lambday_z" name="quantity" min="-3" max="3" value="0" step="0.2">
            </td>
            <td class="value">
                <label for="right_lambdax_z">Lambda X:</label>
                <input type="number" id="right_lambdax_z" name="quantity" min="-3" max="3" value="0" step="0.2">
                <label for="right_lambday_z">Lambda Y:</label>
                <input type="number" id="right_lambday_z" name="quantity" min="-3" max="3" value="0" step="0.2">
            </td>
        </tr>
        <tr>
            <td class="name">Rotate Speed</td>
            <td class="value">
                <input type="range" min="0" max="40" value="3" class="obj_controller" id="leftSpinSpeed">
            </td>
            <td class="value">
                <input type="range" min="0" max="40" value="3" class="obj_controller" id="midSpinSpeed">
            </td>
            <td class="value">
                <input type="range" min="0" max="40" value="3" class="obj_controller" id="rightSpinSpeed">
            </td>
        </tr>
        <tr>
            <td class="name">Rotate Direction</td>
            <td class="value radios">
                <div>
                    <input type="radio" id="clocLeft" name="leftDir" value="-1" class="table_radio">
                    <label for="clocLeft">Clockwise</label>
                </div>
                <div>
                    <input type="radio" id="counterLeft" name="leftDir" value="1" checked class="table_radio">
                    <label for="counterLeft">Counterclockwise</label>
                </div>
            </td>
            <td class="value radios">
                <div>
                    <input type="radio" id="clockMid" name="midDir" value="-1" class="table_radio">
                    <label for="clockMid">Clockwise</label>
                </div>
                <div>
                    <input type="radio" id="counterMid" name="midDir" value="1" checked class="table_radio">
                    <label for="counterMid">Counterclockwise</label>
                </div>
            </td>
            <td class="value radios">
                <div>
                    <input type="radio" id="clockRight" name="rightDir" value="-1" class="table_radio">
                    <label for="clockRight">Clockwise</label>
                </div>
                <div>
                    <input type="radio" id="counterRight" name="rightDir" value="1" checked class="table_radio">
                    <label for="counterRight">Counterclockwise</label>
                </div>
            </td>
        </tr>
    </table>
    <table class="table2">
        <tr>
            <td class="name"></td>
            <td class="value">First Light</td>
            <td class="value">Second Light</td>
            <td class="value">Third Light</td>
        </tr>
        <tr>
            <td class="name">Position</td>
            <td class="value">
                <label for="First_x">X:</label>
                <input type="text" id="First_x" value="0"></br>
                <label for="First_y">Y:</label>
                <input type="text" id="First_y" value="0"></br>
                <label for="First_z">Z:</label>
                <input type="text" id="First_z" value="-30">
            </td>
            <td class="value">
                <label for="Second_x">X:</label>
                <input type="text" id="Second_x" value="0"></br>
                <label for="Second_y">Y:</label>
                <input type="text" id="Second_y" value="30"></br>
                <label for="Second_z">Z:</label>
                <input type="text" id="Second_z" value="0">
            </td>
            <td class="value">
                <label for="Third_x">X:</label>
                <input type="text" id="Third_x" value="30"></br>
                <label for="Third_y">Y:</label>
                <input type="text" id="Third_y" value="0"></br>
                <label for="Third_z">Z:</label>
                <input type="text" id="Third_z" value="0">
            </td>
        </tr>
        <tr>
            <td class="name">Color</td>
            <td class="value">
                <label for="First_r">R:</label>
                <input type="range" id="First_r" min="0" max="1" value="0.7" step="0.05" class="obj_controller"></br>
                <label for="First_g">G:</label>
                <input type="range" id="First_g" min="0" max="1" value="0.0" step="0.05" class="obj_controller"></br>
                <label for="First_b">B:</label>
                <input type="range" id="First_b" min="0" max="1" value="0.0" step="0.05" class="obj_controller">
            </td>
            <td class="value">
                <label for="Second_r">R:</label>
                <input type="range" id="Second_r" min="0" max="1" value="0.0" step="0.05" class="obj_controller"></br>
                <label for="Second_g">G:</label>
                <input type="range" id="Second_g" min="0" max="1" value="0.7" step="0.05" class="obj_controller"></br>
                <label for="Second_b">B:</label>
                <input type="range" id="Second_b" min="0" max="1" value="0.0" step="0.05" class="obj_controller">
            </td>
            <td class="value">
                <label for="Third_r">R:</label>
                <input type="range" id="Third_r" min="0" max="1" value="0.0" step="0.05" class="obj_controller"></br>
                <label for="Third_g">G:</label>
                <input type="range" id="Third_g" min="0" max="1" value="0.0" step="0.05" class="obj_controller"></br>
                <label for="Third_b">B:</label>
                <input type="range" id="Third_b" min="0" max="1" value="0.7" step="0.05" class="obj_controller">
            </td>
        </tr>
        <tr>
            <td class="name">Brightness Jitter</td>
            <td class="value">
                <label for="LeftMax">Max:</label>
                <input type="range" id="LeftMax" min="0" max="1" value="0.5" step="0.05" class="obj_controller">
                <label for="LeftMin">Min:</label>
                <input type="range" id="LeftMin" min="0" max="1" value="0.5" step="0.05" class="obj_controller">
            </td>
            <td class="value">
                <label for="MidMax">Max:</label>
                <input type="range" id="MidMax" min="0" max="1" value="0.5" step="0.05" class="obj_controller">
                <label for="MidMin">Min:</label>
                <input type="range" id="MidMin" min="0" max="1" value="0.5" step="0.05" class="obj_controller">
            </td>
            <td class="value">
                <label for="RightMax">Max:</label>
                <input type="range" id="RightMax" min="0" max="1" value="0.5" step="0.05" class="obj_controller">
                <label for="RightMin">Min:</label>
                <input type="range" id="RightMin" min="0" max="1" value="0.5" step="0.05" class="obj_controller">
            </td>
        </tr>
        <!-- <tr>
            <td class="name">Clipping Z</td>
            <td class="value">
                <input type="range" min="0.1" max="100" value="100" class="obj_controller" id="clipMax">
            </td>
            <td class="value">
                <input type="range" min="0.1" max="100" value="0.1" class="obj_controller" id="clipMin">
            </td>
        </tr> -->
    </table>
</div>
</body>
</html>